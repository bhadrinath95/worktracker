{% extends 'tracker/base.html' %}
{% block content %}
<h1>Edit Update for "{{ update.task.name }}"</h1>

<form method="POST">
  {% csrf_token %}
  {{ form.as_p }}

  <h4>Edit Documents</h4>
  <div id="formset">
    {{ formset.management_form }}
    {% for form in formset %}
      <div class="card mb-2 p-2">
        {{ form.as_p }}
      </div>
    {% endfor %}
  </div>

  <button type="button" class="btn btn-secondary mb-2" id="add-more">Add Another Document</button>
  <br>
  <button type="submit" class="btn btn-success">Save Changes</button>
  <a href="{% url 'update_list' update.task.id %}" class="btn btn-secondary">Cancel</a>
</form>

<script>
document.getElementById('add-more').addEventListener('click', function() {
    const formsetDiv = document.getElementById('formset');
    const totalForms = document.getElementById('id_form-TOTAL_FORMS');
    const currentCount = parseInt(totalForms.value);
    const newForm = formsetDiv.querySelector('.card').cloneNode(true);

    // Clear previous values
    newForm.querySelectorAll('input').forEach(input => {
        input.value = '';
    });

    // Update form index names and IDs (important!)
    newForm.innerHTML = newForm.innerHTML.replace(/form-(\d+)-/g, `form-${currentCount}-`);

    // Append to formset
    formsetDiv.appendChild(newForm);

    // Increment management form count
    totalForms.value = currentCount + 1;
});
</script>

{% endblock %}
